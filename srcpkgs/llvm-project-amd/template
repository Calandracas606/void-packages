# Template file for 'llvm-project-amd'
pkgname=llvm-project-amd
version=5.6.1
revision=1
build_wrksrc=llvm
build_style=cmake
configure_args=" 
	-DCMAKE_INSTALL_PREFIX=/usr/lib/rocm/llvm
	-DCMAKE_PREFIX_PATH=/usr/lib/rocm
	-DLLVM_ENABLE_PROJECTS=clang;lld;clang-tools-extra;compiler-rt
	-DCMAKE_BUILD_TYPE=Release
	-DCMAKE_RELEASE_TYPE=Release
	-DLLVM_ENABLE_ASSERTIONS=ON
	-DLLVM_TARGETS_TO_BUILD=AMDGPU;X86
	-DLLVM_ENABLE_BINDINGS=OFF 
	-DLLVM_INCLUDE_BENCHMARKS=OFF
	-DCLANG_DEFAULT_LINKER=lld
	-DLLVM_BUILD_LLVM_DYLIB=OFF
	-DLLVM_LINK_LLVM_DYLIB=OFF
	-DCLANG_LINK_CLANG_DYLIB=OFF
	-DCLANG_ENABLE_AMDCLANG=ON
	-DLLVM_ENABLE_RUNTIMES=libcxx;libcxxabi
	-DLIBCXX_ENABLE_STATIC=ON
	-DLIBCXXABI_ENABLE_STATIC=ON
"
hostmakedepends="pkg-config git python3 ROCm-cmake"
makedepends="libffi-devel ncurses-libtinfo-devel zlib-devel libxml2-devel libzstd-devel libedit-devel"
depends=""
short_desc="LLVM Project for ROCm"
maintainer="Daniel Martinez <danielmartinez@airmail.cc>"
license="MIT"
homepage="https://github.com/RadeonOpenCompute/llvm-project"
distfiles="${homepage}/archive/refs/tags/rocm-${version}.tar.gz"
checksum=045e43c0c4a3f4f2f1db9fb603a4f1ea3d56e128147e19ba17909eb57d7f08e5
python_version=3
subpackages="llvm-project-amd-devel"

_llvm_version=16.0.0

llvm-project-amd-devel_package() {
	short_desc+=" - development files"
	depends="llvm-project-amd>=${version}_${revision}"
	pkg_install() {
		vmove usr/lib/rocm/llvm/include
		vmove usr/lib/rocm/llvm/lib/cmake
		vmove "usr/lib/rocm/llvm/lib/*.a"
		vmove "/usr/lib/rocm/llvm/lib/clang/${_llvm_version}/include"
		vmove "/usr/lib/rocm/llvm/lib/clang/${_llvm_version}/lib/linux/*.a"
		vmove "/usr/lib/rocm/llvm/lib/clang/${_llvm_version}/lib/linux/*.a.syms"
		vmove "/usr/lib/rocm/llvm/lib/clang/${_llvm_version}/lib/linux/*.o"
		vmove "/usr/lib/rocm/llvm/lib/clang/${_llvm_version}/share"
		vmove /usr/lib/rocm/llvm/share
		vmove /usr/lib/rocm/llvm/lib/libscanbuild
		vmove /usr/lib/rocm/llvm/lib/libear
	}
}

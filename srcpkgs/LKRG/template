# Template file for 'LKRG'
pkgname=LKRG
version=0.9.8
revision=1
build_wrksrc=logger
build_style=gnu-makefile
make_install_args="SBINDIR=/usr/bin"
conf_files="/usr/lib/sysctl.d/01-lkrg.conf"
make_dirs="/var/log/_lkrg_logger 700 _lkrg_logger _lkrg_logger"
depends="dkms openssl"
short_desc="Linux Kernel Runtime Guard"
maintainer="Daniel Martinez <danielmartinez@cock.li>"
license="GPL-2.0-only"
homepage="https://lkrg.org/"
changelog="https://raw.githubusercontent.com/lkrg-org/lkrg/main/CHANGES"
distfiles="https://github.com/lkrg-org/lkrg/archive/refs/tags/v${version}.tar.gz"
checksum=9ded23a2b466c25561fe5a3c4b7d06688bc8364f73ac57770fba5511c1499253
system_accounts="_lkrg_logger"
triggers="dkms"
dkms_modules="lkrg ${version}"


pre_build() {
	export LD=$CC

	# This changes the account used by the logging daemon to "_lkrg_logger"
	vsed 's|lkrg-logger|_lkrg_logger|' -i params.h
}

post_install() {
	vinstall ../scripts/bootup/lkrg.conf 644 usr/lib/sysctl.d 01-lkrg.conf

	vmkdir usr/lib/modules-load.d
	echo "lkrg" > ${DESTDIR}/usr/lib/modules-load.d/lkrg.conf

	vsv lkrg-logger

	vsrcextract -C ${DESTDIR}/usr/src/lkrg-${version} "v${version}.tar.gz"
}

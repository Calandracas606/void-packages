# Template file for 'ROCr-Runtime'
pkgname=ROCr-Runtime
version=6.3.0
revision=1
build_style=cmake
_rocm_prefix="usr/lib/rocm"
configure_args="
 -DCMAKE_PREFIX_PATH=${XBPS_CROSS_BASE}/${_rocm_prefix};${XBPS_CROSS_BASE}/${_rocm_prefix}/lib/llvm
 -DBUILD_SHARED_LIBS=ON "
hostmakedepends="ROCm-cmake pkg-config xxd"
makedepends="llvm-amd-devel ROCm-Device-Libs ROCt-Thunk-Interface-devel
libnuma-devel elfutils-devel libdrm-devel libffi-devel libxml2-devel ncurses-libtinfo-devel libedit-devel"
short_desc="HSA Runtime API and runtime for ROCm"
maintainer="Daniel Martinez <danielmartinez@cock.li>"
license="NCSA"
homepage="https://github.com/ROCm/ROCR-Runtime"
distfiles="https://github.com/ROCm/ROCR-Runtime/archive/refs/tags/rocm-${version}.tar.gz"
checksum=8fd6bcd6a5afd0ae5a59e33b786a525f575183d38c34049c2dab6b9270a1ca3b

post_install() {
	# files copied from ROCt-Thunk-Interface-devel
	rm ${DESTDIR}/usr/include/hsakmt/hsakmt.h
	rm ${DESTDIR}/usr/include/hsakmt/hsakmttypes.h
	rm ${DESTDIR}/usr/lib/cmake/hsakmt/hsakmt-config-version.cmake
	rm ${DESTDIR}/usr/lib/cmake/hsakmt/hsakmt-config.cmake
	rm ${DESTDIR}/usr/lib/cmake/hsakmt/hsakmtTargets-none.cmake
	rm ${DESTDIR}/usr/lib/cmake/hsakmt/hsakmtTargets.cmake
	rm ${DESTDIR}/usr/lib/pkgconfig/libhsakmt.pc
}

ROCr-Runtime-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/lib/cmake
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.a"
	}
}

# Template file for 'ROCm-clr'
pkgname=ROCm-clr
version=6.0.0
revision=1
build_wrksrc=clr-rocm-${version}
build_style=cmake
_clr_dir=${XBPS_BUILDDIR}/${pkgname}-${version}/clr-rocm-${version}
_hip_dir=${XBPS_BUILDDIR}/${pkgname}-${version}/HIP-rocm-${version}
#_clr_dir=${wrksrc}/clr-rocm-${version}
#_hip_dir=${wrksrc}/HIP-rocm-${version}
configure_args="
	-DCLR_BUILD_HIP=ON
	-DHIP_COMMON_DIR=$_hip_dir
	-DHIPCC_BIN_DIR=/usr/bin
	-DROCM_PATH=/usr
"
#	-DCLR_BUILD_OCL=ON
# -DCMAKE_INSTALL_PREFIX=/usr/lib/rocm
#	-DCMAKE_PREFIX_PATH=/usr/lib/rocm
#	-DCMAKE_INSTALL_RPATH=/usr/lib
#	-DCMAKE_INSTALL_RPATH_USE_LINK_PATH=True
#hostmakedepends="llvm-project-amd ROCm-cmake pkg-config xxd git python3-cppheaderparser"
hostmakedepends="llvm-project-amd-devel ROCm-cmake pkg-config xxd git python3-cppheaderparser"
#makedepends="llvm-project-amd-devel ROCr-devel comgr-devel libnuma-devel MesaLib-devel ncurses-libtinfo-devel libxml2-devel libzstd-devel"
makedepends="hipcc ROCr comgr libnuma-devel libffi-devel libedit-devel MesaLib-devel ncurses-libtinfo-devel libxml2-devel libzstd-devel"
depends="comgr-${version}_${revision} ROCr-${version}_${revision}"
#conflicts="comgr>${version}_999 comgr<${version} ROCr>${version}_999 ROCr<${version} hipcc"
short_desc="AMD CLR - Compute Language Runtimes"
maintainer="Daniel Martinez <danielmartinez@cock.li>"
license="MIT"
homepage="https://github.com/ROCm-Developer-Tools/clr"
distfiles=" ${homepage}/archive/refs/tags/rocm-${version}.tar.gz>CLR-${version}.tar.gz
 https://github.com/ROCm-Developer-Tools/HIP/archive/refs/tags/rocm-${version}.tar.gz>HIP-${version}.tar.gz"
# https://github.com/ROCm-Developer-Tools/HIPCC/archive/refs/tags/rocm-${version}.tar.gz>HIPCC-${version}.tar.gz "
checksum="798b55b5b5fb90dd19db54f136d8d8e1da9ae1e408d5b12b896101d635f97e50
 0d575788e0b731124a8489a36652014a165b9ebab92d5456ec3c976e062f3a82"
# d47d27ef2b5de7f49cdfd8547832ac9b437a32e6fc6f0e9c1646f4b704c90aee"
#subpackages="HIP-devel HIP ROCm-clr-devel"
subpackages="HIP"

export CLR_DIR="${_clr_dir}"
export HIP_DIR="${_hip_dir}"
#export HIPCC_DIR="${_hipcc_dir}"
#export HIP_CLANG_PATH=/usr/bin
export ROCM_PATH=/usr

#pre_configure() {
#	echo "MY WRKSRC: ${wrksrc}"
#	echo "${_clr_dir}"
#	echo "${_hip_dir}"
#}

post_install() {
	vlicense ${_clr_dir}/LICENCE
	vlicense ${_clr_dir}/hipamd/LICENSE.txt
}

#HIP-devel_package() {
#	short_desc+="ROCm HIP Compiler - development files"
#	depends="HIP-${version}_${revision} ROCm-clr-devel-${version}_${revision}"
#	pkg_install() {
#		vmove /usr/lib/cmake/hip
#		vmove /usr/include/hip
#	}
#}

HIP_package() {
	short_desc+="ROCm HIP Compiler "
	depends="ROCm-clr-${version}_${revision}"
	pkg_install() {
#		vmove /usr/hip
		vmove "/usr/bin/hip*"
		vlicense ${_hip_dir}/LICENSE.txt
#		vmove /usr/include/hip
	}
}

#ROCm-clr-devel_package() {
#	short_desc+="AMD CLR - Compute Language Runtimes - development files"
#	depends="ROCm-clr-${version}_${revision}"
#	pkg_install() {
#		vmove /usr/lib/cmake
#		vmove /usr/include
#	}
#}

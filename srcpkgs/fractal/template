# Template file for 'fractal'
pkgname=fractal
version=5
revision=1
build_style=meson
build_helper="rust"
hostmakedepends="cargo pkg-config glib-devel gettext desktop-file-utils gtk4-update-icon-cache clang"
makedepends="gtk4-devel libglib-devel openssl-devel gstreamer1-devel
 cairo-devel gettext-devel gst-plugins-base1-devel gst-plugins-bad1-devel
 gst1-editing-services-devel gtksourceview5-devel pango-devel gspell-devel
 gmp-devel libsecret-devel libhandy-devel rust-std libadwaita-devel
 pipewire-devel libshumate-devel xdg-desktop-portal"
short_desc="Matrix Messaging Client for GNOME"
maintainer="Cameron Nemo <cam@nohom.org>"
license="GPL-3.0-or-later"
homepage="https://wiki.gnome.org/Apps/Fractal"
distfiles="https://gitlab.gnome.org/GNOME/fractal/-/archive/${version}/fractal-${version}.tar.gz"
checksum=649fbf06810fb3636098cf576773daa3065879794bb1e1984c6cd1bd2509d045

post_patch() {
	cat <<-EOF >> "Cargo.toml"
	[patch.crates-io]
	pipewire = {git="https://gitlab.freedesktop.org/pipewire/pipewire-rs.git", rev="ff923ee9dfe05ac50a137252ca45ac4361016360"}
	EOF
	# Needed to get the above to register
	cargo update --package pipewire@0.7.2 --precise 0.7.2
	[ -z "$CROSS_BUILD" ] && return 0

	vsed -i src/meson.build \
		-e "s|'cp', 'src' / |'cp', 'src'  / '$RUST_TARGET' / |"
}
